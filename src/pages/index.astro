---
import Layout from '../layouts/Layout.astro';
import ArticleCard from '../components/ArticleCard.astro';
import { getFeaturedPatterns } from '../data/patterns';
import { getAllArticles } from '../data/articles';
import logo from '../assets/images/ktca-logo-2026.png';
import feet1 from '../assets/images/feet1.jpg';
import glove1 from '../assets/images/glove1.jpg';
import glove2 from '../assets/images/glove2.jpg';
import glove3 from '../assets/images/glove3.jpg';
import article2 from '../assets/images/article2.png';
import article3 from '../assets/images/article3.png';
import yarnchoice from '../assets/images/yarnchoice.png';
import katicCrochet from '../assets/images/katic-crochet.jpg';
import katicaPortrait from '../assets/images/katica-portrait.jpeg';
import crochetSensitiveSkinYarn from '../assets/images/crochet-sensitive-skin-yarn.png';
import crochetCommunication from '../assets/images/crochet-communication.png';
import piccLineWarmer from '../assets/images/picc-line-warmer.png';

const featuredPatterns = getFeaturedPatterns().slice(0, 3);
const articles = getAllArticles();
const imageMap: Record<string, { src: string }> = { feet1, glove1, glove2, glove3, piccLineWarmer };
const articleImageMap: Record<string, string> = {
	yarnchoice: yarnchoice.src,
	article2: article2.src,
	article3: article3.src,
};
const base = import.meta.env.BASE_URL;

const PLAYLIST_ID = 'PLN6Hh6ZaNqtLpIprlr3D4n2VHmoc1woiL';
let preloadedPlaylistItems: Array<{ snippet: { title: string; description?: string; resourceId?: { videoId: string }; thumbnails?: Record<string, { url: string }> } }> = [];
const apiKey = import.meta.env.PUBLIC_YOUTUBE_API_KEY;
if (apiKey) {
	try {
		const res = await fetch(
			`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${PLAYLIST_ID}&maxResults=8&key=${apiKey}`
		);
		const data = await res.json();
		if (data.items && Array.isArray(data.items) && data.items.length > 0) {
			preloadedPlaylistItems = data.items;
		}
	} catch (_) {
		// Preload failed; client will try fetch or show fallback
	}
}
---
<Layout>
    <header class="pt-16 sm:pt-20 lg:pt-24 pb-24 sm:pb-32 lg:pb-40 px-4 sm:px-6 relative bg-paper overflow-hidden">
        <div class="max-w-4xl mx-auto text-center relative z-10">
            <div class="flex justify-center mb-6 sm:mb-8 opacity-60 text-moss-custom-800 animate-[float_4s_ease-in-out_infinite]">
                <svg width="40" height="20" viewBox="0 0 40 20" stroke="currentColor" stroke-width="1.5" fill="none" class="w-8 sm:w-10"><path d="M20 20 C20 20 12 8 0 8 M20 20 C20 20 28 8 40 8"/><circle cx="20" cy="4" r="2.5" fill="currentColor"/></svg>
            </div>
            <h1 class="h1-hero text-4xl sm:text-5xl md:text-6xl lg:text-7xl text-stone-custom-900 mb-6 sm:mb-8 leading-tight">Where knitting <br> becomes care</h1>
            <p class="text-lg sm:text-xl text-stone-custom-600 mb-8 sm:mb-12 max-w-xl mx-auto font-medium leading-relaxed px-1">Knit with purpose, and help where it matters.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-4 sm:gap-5 items-center">
                <a href="#patterns" class="btn-primary px-8 sm:px-10 py-3.5 sm:py-4 text-base sm:text-lg font-serif italic shadow-lg w-full sm:w-auto text-center min-h-[48px] flex items-center justify-center rounded-full">Find a Pattern of Care</a>
                <a href="#free-school" class="bg-white/80 backdrop-blur border-2 border-stone-custom-300 text-stone-custom-800 px-8 sm:px-10 py-3.5 sm:py-4 rounded-full font-serif italic text-base sm:text-lg hover:border-teal-custom-900 hover:bg-teal-custom-50 transition-all shadow-sm hover:shadow-md w-full sm:w-auto text-center min-h-[48px] flex items-center justify-center font-medium">Join the Inner Circle (Free)</a>
            </div>
            <div class="mt-10 sm:mt-16 flex justify-center">
                <img src={logo.src} alt="Emblem" class="w-48 sm:w-56 md:w-64 lg:w-72 max-w-full opacity-95 drop-shadow-xl animate-[float_6s_ease-in-out_infinite] mix-blend-multiply">
            </div>
        </div>
    </header>

    <section id="patterns" class="bg-paper pb-20 sm:pb-24 lg:pb-32 relative z-10 overflow-hidden">
        <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-12">
            <div class="border-b border-stone-200 pb-10 mb-16">
                <h2 class="font-serif text-4xl md:text-5xl text-stone-custom-900 mb-3">Patterns of Care</h2>
                <p class="text-stone-custom-600 font-medium opacity-80">Thoughtfully designed for sensory needs, medical comfort, and the people who provide it.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
                {featuredPatterns.map((p) => {
                    const imgSrc = p.imageUrl ?? (p.imageKey && imageMap[p.imageKey] ? imageMap[p.imageKey].src : '');
                    return (
                        <a href={base + p.detailUrl.replace(/^\//, '')} class="pattern-card group cursor-pointer bg-white rounded-2xl border border-stone-200 shadow-sm hover:shadow-xl transition-all card-hover flex flex-col overflow-hidden block">
                            <div class="aspect-[10/11] rounded-t-2xl overflow-hidden relative border-b border-stone-100 flex-shrink-0">
                                {p.badge && <span class="absolute top-3 left-3 z-10 text-[10px] font-bold uppercase tracking-wider bg-white text-teal-custom-900 border-2 border-teal-custom-900 px-3 py-1.5 rounded-full shadow-sm">{p.badge}</span>}
                                {imgSrc && <img src={imgSrc} alt="" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">}
                                <div class="absolute inset-0 bg-moss-custom-900/0 group-hover:bg-moss-custom-900/5 transition-colors pointer-events-none"></div>
                            </div>
                            <div class="p-6 sm:p-8 flex flex-col flex-grow min-h-0 text-center">
                                <h3 class="font-serif text-xl font-semibold text-stone-custom-900 mb-2">{p.title}</h3>
                                <p class="text-sm text-stone-custom-500 leading-relaxed line-clamp-1 mb-6">{p.medicalBenefit ?? p.shortDescription}</p>
                                <div class="pt-6 border-t border-stone-100 mt-auto flex flex-col items-center">
                                    <p class="font-serif text-xl font-semibold text-stone-custom-900 mb-3">{p.price}</p>
                                    {p.hasBeginner && p.hasAdvanced && <p class="text-[11px] text-stone-custom-500 mb-5">2 for 1 — Classic Utility + Artisan Detail</p>}
                                    <span class="inline-block w-full max-w-[200px] text-center text-[11px] font-bold uppercase tracking-widest text-stone-custom-600 border-2 border-stone-200 px-5 py-3 rounded-full group-hover:bg-teal-custom-900 group-hover:text-white group-hover:border-teal-custom-900 transition-all">View Pattern</span>
                                </div>
                            </div>
                        </a>
                    );
                })}
            </div>

            <div class="patterns-for-purpose-callout mt-12 sm:mt-14 w-full rounded-2xl border-2 border-teal-custom-200 bg-teal-custom-50 px-6 sm:px-10 py-10 sm:py-12">
                <p class="text-stone-custom-800 text-base sm:text-lg leading-relaxed font-medium mb-4 text-center max-w-2xl mx-auto">Many of our Patterns of Care feature two ways to knit: a <span class="font-semibold text-stone-custom-900">'Classic Utility'</span> version for beginners and an <span class="font-semibold text-stone-custom-900">'Artisan Detail'</span> version for those who love a complex, soulful challenge. Look for the <strong>2 for 1</strong> note on select projects.</p>
                <p class="text-stone-custom-600 text-sm font-medium text-center mb-8">Members get 40% off one pattern per month.</p>
                <div class="flex justify-center">
                    <a href={base + 'patterns/'} class="inline-flex items-center justify-center gap-2 btn-primary text-[11px] font-bold uppercase tracking-[0.2em] px-10 py-4 rounded-full group">
                        View All Patterns <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>
        </div>
        
        <svg class="wave-divider text-stone-custom-100 fill-current" viewBox="0 0 1440 100" preserveAspectRatio="none"><path d="M0,50 C320,130 600,0 920,50 C1240,100 1440,50 1440,50 V100 H0 V50 Z"></path></svg>
    </section>

    <section id="sensory-crochet" class="bg-teal-custom-50/80 py-16 sm:py-24 lg:py-32 relative overflow-hidden">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12 sm:mb-16">
                <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-teal-custom-800 block mb-4">Development &amp; Sensory Tools</span>
                <h2 class="font-serif text-3xl sm:text-4xl lg:text-5xl text-stone-custom-900 mb-6">Sensory Crochet: Tools for Growth</h2>
                <p class="text-stone-custom-600 text-lg leading-relaxed font-medium max-w-3xl mx-auto">Crochet is about more than just stitches—it's about the unique texture and comfort only a hook can create. We are building a library of handmade tools designed to bring calm, focus, and connection to those with complex needs. If you create with heart and purpose, we want to build this with you.</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 sm:gap-8">
                <div class="text-center">
                    <div class="aspect-square rounded-2xl overflow-hidden border-2 border-white shadow-lg mb-4 bg-white">
                        <img src={katicCrochet.src} alt="Crochet in progress — hands and texture" class="w-full h-full object-cover">
                    </div>
                    <p class="text-base font-semibold text-stone-custom-800">Texture &amp; rhythm</p>
                    <p class="text-sm text-stone-custom-600 mt-2 leading-relaxed">The feel of yarn and the motion of stitches support focus and calm.</p>
                </div>
                <div class="text-center">
                    <div class="aspect-square rounded-2xl overflow-hidden border-2 border-white shadow-lg mb-4 bg-white">
                        <img src={crochetSensitiveSkinYarn.src} alt="Yarn and materials for sensory-friendly making" class="w-full h-full object-cover">
                    </div>
                    <p class="text-base font-semibold text-stone-custom-800">Mindful materials</p>
                    <p class="text-sm text-stone-custom-600 mt-2 leading-relaxed">Soft, chosen fibres that suit sensitive hands and sensory needs.</p>
                </div>
                <div class="text-center">
                    <div class="aspect-square rounded-2xl overflow-hidden border-2 border-white shadow-lg mb-4 bg-white">
                        <img src={crochetCommunication.src} alt="Finished piece — comfort and care" class="w-full h-full object-cover">
                    </div>
                    <p class="text-base font-semibold text-stone-custom-800">Purpose in every stitch</p>
                    <p class="text-sm text-stone-custom-600 mt-2 leading-relaxed">From development tools to communication aids, made with intention.</p>
                </div>
            </div>

            <div class="mt-16 sm:mt-20 max-w-2xl mx-auto text-center px-6 py-12 sm:py-16 rounded-3xl border border-teal-custom-200/80 bg-white/70 shadow-lg callout-collective">
                <h3 class="font-serif text-2xl sm:text-3xl text-stone-custom-900 mb-6">Become a Crochet Pattern Partner</h3>
                <p class="text-stone-custom-600 text-base sm:text-lg leading-relaxed font-medium mb-10">We are looking for original, high-quality patterns that serve a true purpose. Share your designs to help families in need and earn on every sale. Let's turn your skill into tangible support for those who need it most.</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
                    <a href="mailto:hello@katica.co.uk?subject=Pattern%20submission%20for%20KTCA%20Collective" class="btn-primary inline-flex items-center justify-center px-10 py-4 text-sm font-bold uppercase tracking-[0.2em] rounded-full shadow-lg hover:scale-105 transition-transform w-full sm:w-auto">Submit a Pattern</a>
                    <button type="button" class="crochet-partner-learn-more btn-secondary inline-flex items-center justify-center px-10 py-4 text-sm font-bold uppercase tracking-[0.2em] rounded-full w-full sm:w-auto">Learn More</button>
                </div>
            </div>
        </div>
    </section>

    <section id="tutorials" class="bg-stone-custom-100 py-16 sm:py-24 lg:py-32 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-12">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12">
                <div>
                    <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-teal-custom-900 block mb-2">Video Guidance</span>
                    <h2 class="font-serif text-4xl md:text-5xl text-stone-custom-900 mb-4">Learn with Purpose</h2>
                    <a href="https://www.youtube.com/playlist?list=PLN6Hh6ZaNqtLpIprlr3D4n2VHmoc1woiL" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-[11px] font-bold uppercase tracking-[0.2em] text-stone-custom-600 hover:text-teal-custom-900 transition-colors border-b border-transparent hover:border-teal-custom-900 pb-0.5">
                        <span>Check out my YouTube Channel</span>
                        <i data-lucide="external-link" class="w-4 h-4"></i>
                    </a>
                </div>
                <div class="flex gap-3 mt-6 md:mt-0">
                    <button type="button" id="prevBtn" class="w-12 h-12 min-w-[48px] min-h-[48px] rounded-full border-2 border-stone-300 flex items-center justify-center hover:bg-white active:bg-stone-100 transition-all text-stone-600 bg-paper/50 touch-manipulation" aria-label="Previous"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                    <button type="button" id="nextBtn" class="w-12 h-12 min-w-[48px] min-h-[48px] rounded-full border-2 border-stone-300 flex items-center justify-center hover:bg-white active:bg-stone-100 transition-all text-stone-600 bg-paper/50 touch-manipulation" aria-label="Next"><i data-lucide="arrow-right" class="w-5 h-5"></i></button>
                </div>
            </div>

            <div class="relative w-full overflow-hidden">
                <div id="playlist-videos-container" class="flex gap-8 overflow-x-auto no-scrollbar pb-10 snap-x snap-mandatory pr-12 items-start min-h-[200px]">
                    <p class="text-center text-stone-custom-600 py-12 flex-shrink-0" id="playlist-loading">Loading videos…</p>
                </div>
            </div>

            <svg class="wave-divider text-moss-custom-100 fill-current" viewBox="0 0 1440 100" preserveAspectRatio="none"><path d="M0,50 C320,130 600,0 920,50 C1240,100 1440,50 1440,50 V100 H0 V50 Z"></path></svg>
        </div>
    </section>

    <section class="bg-moss-custom-100 py-16 sm:py-24 lg:py-32 relative z-10 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-12">
            <div class="grid lg:grid-cols-2 gap-10">
                <div id="free-school" class="bg-white rounded-[3rem] p-12 border border-stone-200 shadow-soft flex flex-col justify-center text-center group cursor-default transition-all community-card">
                    <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-moss-custom-800 mb-6">Free SKOOL Community</span>
                    <h3 class="font-serif text-4xl text-stone-900 mb-6">The Inner Circle</h3>
                    <p class="text-stone-600 mb-10 max-w-sm mx-auto leading-relaxed">Join our first wave of members in this free community built for caregivers and knitters to find each other and truly belong.</p>
                    <div class="flex justify-center -space-x-3 mb-10">
                        <img src={feet1.src} class="w-12 h-12 rounded-full border-4 border-white object-cover shadow-sm community-avatar" alt="">
                        <img src={glove1.src} class="w-12 h-12 rounded-full border-4 border-white object-cover shadow-sm community-avatar" alt="">
                        <img src={glove2.src} class="w-12 h-12 rounded-full border-4 border-white object-cover shadow-sm community-avatar" alt="">
                        <div class="w-12 h-12 rounded-full border-4 border-white bg-moss-custom-50 text-moss-custom-800 flex items-center justify-center text-[10px] font-bold shadow-sm community-avatar">+2k</div>
                    </div>
                    <div class="text-center">
                        <a href="#" class="btn-secondary px-10 py-3.5 rounded-full font-bold uppercase text-[11px] tracking-widest inline-block">Join the Inner Circle</a>
                    </div>
                </div>
                <div id="comfort-studio" class="coaching-card rounded-[3rem] p-12 border border-teal-custom-800 shadow-2xl text-center flex flex-col items-center justify-center text-white relative overflow-hidden group hover:scale-[1.01]">
                    <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(circle, #fff 1px, transparent 1px); background-size: 24px 24px;"></div>
                    
                    <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-teal-custom-100 mb-6 relative z-10 bg-teal-custom-900/50 px-3 py-1 rounded-full backdrop-blur-sm">The Comfort Studio</span>
                    <h3 class="font-serif text-4xl mb-6 relative z-10">The Comfort Studio</h3>
                    <p class="text-teal-custom-100/80 mb-6 max-w-sm mx-auto leading-relaxed relative z-10">Master the craft of care. Every KTCA pattern includes a step-by-step video masterclass so you never get stuck on a stitch.</p>
                    <p class="text-teal-custom-100/90 text-sm font-medium mb-10 max-w-sm mx-auto leading-relaxed relative z-10">Plus bi-weekly Ask Me Anything sessions and a members-only forum for direct support.</p>
                    
                    <div class="flex flex-col sm:flex-row gap-3 justify-center items-center relative z-10">
                        <a href="#" class="btn-primary px-10 py-3.5 rounded-full font-bold uppercase text-[11px] tracking-widest shadow-lg hover:scale-105 inline-block">Join The Comfort Studio</a>
                        <button type="button" class="member-vault-learn-more border-2 border-white/60 text-white px-8 py-3 rounded-full font-bold uppercase text-[11px] tracking-widest hover:bg-white/15 transition-all">Learn More</button>
                    </div>
                    <div class="mt-8 flex items-center gap-2 opacity-60 text-[10px] uppercase tracking-widest relative z-10">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> Limited spots available
                    </div>
                </div>
            </div>
        </div>
        
        <svg class="wave-divider text-paper fill-current" viewBox="0 0 1440 100" preserveAspectRatio="none"><path d="M0,50 C320,130 600,0 920,50 C1240,100 1440,50 1440,50 V100 H0 V50 Z"></path></svg>
    </section>

    <section class="bg-moss-custom-800 py-16 sm:py-24 lg:py-32 relative z-10 text-white border-t border-moss-custom-900 overflow-hidden">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 text-center">
            <div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=\'20\' height=\'20\' viewBox=\'0 0 20 20\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ccircle cx=\'2\' cy=\'2\' r=\'1\' fill=\'%23fff\'/%3E%3C/svg%3E');"></div>
            <div class="relative z-10">
                <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-teal-100/70 mb-6 block">Our Mission</span>
                <h2 class="font-serif text-3xl md:text-5xl leading-tight mb-12 font-medium">Comfort becomes complicated when <br> <span class="italic text-teal-custom-100">complex medical needs</span> arise.</h2>
                <div class="grid md:grid-cols-3 gap-8 text-left mt-16">
                    <div class="mission-card bg-moss-custom-900/70 p-8 sm:p-10 rounded-3xl border border-white/20 backdrop-blur-sm shadow-xl">
                        <div class="icon-wrap w-12 h-12 rounded-2xl bg-white/15 flex items-center justify-center mb-5" aria-hidden="true"><i data-lucide="heart-pulse" class="w-6 h-6"></i></div>
                        <h4 class="text-white text-sm font-bold uppercase tracking-widest mb-4">Medical Friendly</h4>
                        <p class="text-stone-100 text-base leading-relaxed font-medium">Designs that accommodate tubes, lines, and monitors without disconnecting.</p>
                    </div>
                    <div class="mission-card bg-moss-custom-900/70 p-8 sm:p-10 rounded-3xl border border-white/20 backdrop-blur-sm shadow-xl">
                        <div class="icon-wrap w-12 h-12 rounded-2xl bg-white/15 flex items-center justify-center mb-5" aria-hidden="true"><i data-lucide="footprints" class="w-6 h-6"></i></div>
                        <h4 class="text-white text-sm font-bold uppercase tracking-widest mb-4">Orthotic Ready</h4>
                        <p class="text-stone-100 text-base leading-relaxed font-medium">Fits over AFOs, braces, and casts while maintaining warmth and style.</p>
                    </div>
                    <div class="mission-card bg-moss-custom-900/70 p-8 sm:p-10 rounded-3xl border border-white/20 backdrop-blur-sm shadow-xl">
                        <div class="icon-wrap w-12 h-12 rounded-2xl bg-white/15 flex items-center justify-center mb-5" aria-hidden="true"><i data-lucide="hand" class="w-6 h-6"></i></div>
                        <h4 class="text-white text-sm font-bold uppercase tracking-widest mb-4">Sensory Soft</h4>
                        <p class="text-stone-100 text-base leading-relaxed font-medium">Seamless techniques and hypoallergenic fibers for fragile, sensitive skin.</p>
                    </div>
                </div>
            </div>
        </div>
        <svg class="wave-divider text-stone-custom-100 fill-current" viewBox="0 0 1440 100" preserveAspectRatio="none"><path d="M0,50 C320,130 600,0 920,50 C1240,100 1440,50 1440,50 V100 H0 V50 Z"></path></svg>
    </section>

    <section id="about" class="bg-stone-custom-100 py-16 sm:py-24 lg:py-32 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-12 grid lg:grid-cols-2 gap-12 lg:gap-24 items-center">
            <div class="order-2 lg:order-1">
                <div class="flex items-center gap-4 mb-8 text-teal-custom-900 font-bold uppercase tracking-widest text-[10px]">
                    <div class="h-px flex-1 bg-teal-custom-900/30"></div>The Founder's Story<div class="h-px w-12 bg-teal-custom-900/30"></div>
                </div>
                <h2 class="font-serif text-5xl md:text-6xl text-stone-custom-900 leading-[1.1] mb-10">From caring <br> to <span class="italic text-teal-custom-900">creating.</span></h2>
                <div class="space-y-8 text-lg text-stone-custom-600 leading-relaxed font-medium">
                    <p>KTCA started because of <span class="font-semibold text-stone-custom-800">a massive gap in the world of care</span>. For over nine years, I've worked with patients with complex medical care needs and saw a frustrating reality: <span class="font-semibold text-stone-custom-800">you simply cannot buy garments designed for their specific requirements. They don't exist.</span> I started this project to change that—<span class="font-semibold text-stone-custom-800">knitting with purpose</span> by creating patterns for clothing that the fashion industry ignores. We are here to provide the tools to create garments that offer <span class="font-semibold text-stone-custom-800">dignity, comfort, and functionality</span> to <span class="font-semibold text-stone-custom-800">those who have been overlooked.</span></p>
                    <div class="bg-white p-8 rounded-2xl border border-stone-200 shadow-sm inline-block">
                        <div class="flex items-baseline gap-3 mb-2"><span class="font-serif text-3xl italic text-moss-custom-800 font-semibold">Katica</span><span class="text-sm opacity-40 font-mono">/ˈkɒ-ti-tsa/</span></div>
                        <p class="text-xs text-stone-custom-500">Pronounced KAH-tee-tsa.</p>
                    </div>
                </div>
                <div class="mt-12 flex items-center gap-5">
                    <img src={katicaPortrait.src} alt="Katica, KTCA Founder" class="w-16 h-16 rounded-full object-cover border-2 border-white shadow-md">
                    <div class="flex flex-col"><span class="font-serif italic text-teal-custom-900 text-xl font-bold">Made with love</span><span class="text-[9px] uppercase font-bold tracking-widest opacity-60">KTCA Founder</span></div>
                </div>
            </div>
            <div class="relative min-h-[280px] sm:min-h-[360px] lg:h-[600px] order-1 lg:order-2 flex justify-center items-center overflow-visible">
                <div class="absolute w-[220px] h-[280px] sm:w-[280px] sm:h-[360px] lg:w-[380px] lg:h-[500px] bg-white rounded-[2rem] sm:rounded-[3rem] shadow-2xl z-10 overflow-hidden ring-4 sm:ring-[10px] ring-white right-0 sm:-right-4 top-4 sm:-top-8 rotate-3 transition-transform hover:rotate-0 duration-700">
                    <img src={katicCrochet.src} class="w-full h-full object-cover contrast-110" alt="">
                </div>
                <div class="absolute w-[180px] h-[220px] sm:w-[220px] sm:h-[280px] lg:w-[300px] lg:h-[400px] bg-paper rounded-[1.5rem] sm:rounded-[2.5rem] shadow-xl z-20 overflow-hidden border-4 sm:border-[8px] border-white left-0 sm:-left-8 bottom-2 sm:bottom-4 -rotate-6 transition-transform hover:rotate-0 duration-700">
                    <img src={feet1.src} class="w-full h-full object-cover" alt="">
                </div>
                <div class="absolute top-1/2 left-0 z-30 animate-float">
                    <div class="bg-moss-custom-800 text-white rounded-full w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 flex flex-col items-center justify-center font-serif shadow-xl border-2 sm:border-[4px] border-white text-sm lg:text-base"><span class="text-[8px] sm:text-[9px] uppercase tracking-widest opacity-60 font-sans">Est.</span><span class="text-lg sm:text-xl lg:text-2xl font-semibold">2024</span></div>
                </div>
            </div>
        </div>
        <svg class="wave-divider text-paper fill-current" viewBox="0 0 1440 100" preserveAspectRatio="none"><path d="M0,50 C320,130 600,0 920,50 C1240,100 1440,50 1440,50 V100 H0 V50 Z"></path></svg>
    </section>

    <section id="blog" class="bg-paper py-16 sm:py-20 lg:py-24 px-4 sm:px-6 lg:px-8 overflow-hidden">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col items-center mb-16 text-center">
                <span class="text-white uppercase tracking-widest text-xs font-bold mb-4 bg-teal-custom-900 px-6 py-2 rounded-full shadow-md">The Journal</span>
                <h2 class="font-serif text-4xl md:text-5xl text-stone-custom-900 font-semibold">Guidance &amp; Techniques</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10 mb-12">
                {articles.map((article) => {
                    const imgSrc = article.imageUrl ?? (article.imageKey && articleImageMap[article.imageKey] ? articleImageMap[article.imageKey] : '');
                    return (
                        <ArticleCard article={article} imageSrc={imgSrc} baseUrl={base} />
                    );
                })}
            </div>

            <div class="text-center mb-24">
                <a href={base + 'articles/'} class="inline-flex items-center gap-2 text-sm font-bold text-stone-custom-600 hover:text-teal-custom-900 uppercase tracking-wider transition-colors">
                    View all articles <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </a>
            </div>

            <div id="newsletter" class="bg-teal-custom-900 rounded-[4rem] py-24 text-center text-white relative overflow-hidden shadow-2xl border-t-[6px] border-moss-custom-800 group">
                <div class="absolute inset-0 opacity-[0.08]" style="background-image: radial-gradient(circle, #fff 1px, transparent 1px); background-size: 24px 24px;"></div>
                <div class="relative z-10 max-w-2xl mx-auto px-6">
                    <div class="inline-block p-5 bg-moss-custom-800 rounded-full shadow-lg mb-10 ring-4 ring-moss-custom-900/30 group-hover:scale-110 transition-transform"><i data-lucide="heart" class="text-white w-8 h-8"></i></div>
                    <h3 class="font-serif text-4xl md:text-5xl mb-8 leading-tight">A little warmth in your inbox.</h3>
                    <p class="text-teal-custom-100 text-xl italic font-serif mb-12 opacity-90">Get the free guide: "Choosing soft, skin-friendly yarns for sensitive needs".</p>
                    <form class="flex flex-col md:flex-row gap-4 max-w-lg mx-auto">
                        <input type="email" placeholder="Email address" class="flex-1 bg-white/5 border border-white/20 rounded-full px-8 py-4 focus:outline-none focus:bg-white/10 focus:border-white transition-all text-lg font-sans placeholder-white/30 text-white">
                        <button type="submit" class="px-10 py-4 bg-white text-teal-custom-900 rounded-full font-serif font-bold italic text-lg active:scale-95 transition-all shadow-lg hover:bg-stone-100">Download</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div id="memberVaultModalBackdrop" class="member-vault-modal-backdrop" aria-hidden="true" style="position:fixed;inset:0;z-index:100;"></div>
    <div id="memberVaultModal" class="member-vault-modal" role="dialog" aria-modal="true" aria-labelledby="memberVaultModalTitle" aria-hidden="true" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:101;">
        <button type="button" class="member-vault-modal-close" id="memberVaultModalClose" aria-label="Close">×</button>
        <div class="p-8 sm:p-10 overflow-y-auto">
            <p class="text-[10px] font-bold uppercase tracking-[0.25em] text-teal-custom-900 mb-3">The Comfort Studio</p>
            <h2 id="memberVaultModalTitle" class="font-serif text-lg sm:text-xl text-stone-custom-900 mb-4">Master the craft of care. Every KTCA pattern includes a step-by-step video masterclass so you never get stuck on a stitch.</h2>
            <p class="text-stone-custom-600 leading-relaxed mb-6">Join a community built for crafters who knit with purpose. Get the support you need to create garments that offer dignity, comfort, and functionality—without the guesswork.</p>
            <div class="bg-teal-custom-50 border border-teal-custom-200 rounded-2xl p-6 mb-6">
                <p class="text-2xl font-serif font-semibold text-stone-custom-900 mb-1">£6.99 <span class="text-base font-sans font-normal text-stone-custom-600">/ month</span></p>
                <p class="text-sm text-stone-custom-600">Cancel anytime. Full access from day one.</p>
            </div>
            <ul class="space-y-4 text-stone-custom-700 text-sm mb-8">
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5">✓</span> <span><strong>Premium video library</strong> — Step-by-step guides and advanced techniques you won’t find elsewhere.</span></li>
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5">✓</span> <span><strong>Bi-weekly Ask Me Anything sessions</strong> — Get answers to your specific questions during our live calls. Can't attend live? Email your questions in advance and access the video recordings later.</span></li>
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5">✓</span> <span><strong>40% off one pattern of your choice</strong> — Every month you get 40% off one selected pattern or one pattern of your choice.</span></li>
            </ul>
            <a href={base + '#comfort-studio'} class="btn-primary block w-full text-center py-3.5 rounded-full font-bold uppercase text-[11px] tracking-widest">Join The Comfort Studio — £6.99/month</a>
        </div>
    </div>

    <div id="crochetPartnerModalBackdrop" class="crochet-partner-modal-backdrop" aria-hidden="true" style="position:fixed;inset:0;z-index:100;"></div>
    <div id="crochetPartnerModal" class="crochet-partner-modal" role="dialog" aria-modal="true" aria-labelledby="crochetPartnerModalTitle" aria-hidden="true" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:101;">
        <button type="button" class="crochet-partner-modal-close" id="crochetPartnerModalClose" aria-label="Close">×</button>
        <div class="p-8 sm:p-10 overflow-y-auto">
            <h2 id="crochetPartnerModalTitle" class="font-serif text-2xl sm:text-3xl text-stone-custom-900 mb-4">A Partnership with Purpose</h2>
            <p class="text-stone-custom-600 leading-relaxed mb-6">We are looking for designers who create with intention. At KTCA, we don't just sell patterns; we provide solutions for families navigating complex medical and sensory needs. By becoming a Partner, you help build a library of high-quality tools that bring tactile comfort and focus to those who need it most.</p>
            <ul class="space-y-4 text-stone-custom-700 text-sm mb-8">
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5 font-bold">•</span> <span><strong>Quality &amp; Purpose:</strong> Every design is carefully vetted to ensure it meets our standards for functionality and sensory care.</span></li>
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5 font-bold">•</span> <span><strong>Direct Impact:</strong> Your work goes directly into the hands of caregivers looking for meaningful, supportive projects.</span></li>
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5 font-bold">•</span> <span><strong>Earn with Every Stitch:</strong> We believe in rewarding your skill. You will earn a competitive commission on every sale of your pattern.</span></li>
                <li class="flex items-start gap-3"><span class="text-teal-custom-900 mt-0.5 font-bold">•</span> <span><strong>Soulful Collaboration:</strong> Join a community dedicated to making crochet a powerful tool for therapy and growth.</span></li>
            </ul>
            <a href="mailto:hello@katica.co.uk?subject=Crochet%20Pattern%20Partner%20inquiry" class="btn-primary block w-full text-center py-3.5 rounded-full font-bold uppercase text-[11px] tracking-widest">Get in Touch</a>
        </div>
    </div>

    <div id="videoModalBackdrop" class="video-modal-backdrop" aria-hidden="true" style="position:fixed;inset:0;z-index:100;"></div>
    <div id="videoModal" class="video-modal" role="dialog" aria-modal="true" aria-labelledby="videoModalTitle" aria-hidden="true" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:101;">
        <button type="button" class="video-modal-close" id="videoModalClose" aria-label="Close">×</button>
        <div class="video-modal-content">
            <h2 id="videoModalTitle" class="video-modal-title">Watch video</h2>
            <p id="videoModalDescription" class="video-modal-description" aria-hidden="true"></p>
            <div class="aspect-video w-full bg-stone-900 rounded-xl overflow-hidden video-modal-video-wrap">
                <iframe id="videoModalIframe" title="YouTube video" class="w-full h-full" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script define:vars={{ publicYouTubeApiKey: import.meta.env.PUBLIC_YOUTUBE_API_KEY, preloadedPlaylistItems: preloadedPlaylistItems }}>
        (function() {
            var container = document.getElementById('playlist-videos-container');
            var loadingEl = document.getElementById('playlist-loading');
            var playlistId = 'PLN6Hh6ZaNqtLpIprlr3D4n2VHmoc1woiL';
            var fallbackHtml = '<p class="text-center text-stone-custom-600 py-8 flex-shrink-0">Unable to load videos.</p><a href="https://www.youtube.com/playlist?list=' + playlistId + '" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-teal-custom-900 font-semibold hover:underline flex-shrink-0">Open playlist on YouTube</a>';
            function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
            function renderItems(items) {
                var html = '';
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    var sn = item.snippet || {};
                    var vid = (sn.resourceId && sn.resourceId.videoId) || '';
                    if (!vid) continue;
                    var title = esc(sn.title || '');
                    var rawDesc = (sn.description || '').replace(/\s+/g, ' ').trim();
                    var desc = rawDesc.length > 150 ? rawDesc.slice(0, 150) + '…' : rawDesc;
                    desc = esc(desc);
                    var descForModal = rawDesc.length > 300 ? rawDesc.slice(0, 300) + '…' : rawDesc;
                    var thumbs = sn.thumbnails || {};
                    var thumb = (thumbs.maxresdefault && thumbs.maxresdefault.url) || (thumbs.high && thumbs.high.url) || (thumbs.medium && thumbs.medium.url) || 'https://img.youtube.com/vi/' + vid + '/hqdefault.jpg';
                    html += '<div class="video-card-width snap-start">';
                    html += '<button type="button" class="video-card-trigger text-left w-full group cursor-pointer block" data-video-id="' + vid + '" data-video-title="' + esc(sn.title || '') + '" data-video-description="' + esc(descForModal) + '" aria-label="Play: ' + title + '">';
                    html += '<div class="relative aspect-video bg-stone-800 rounded-[2rem] overflow-hidden shadow-lg border-[6px] border-white ring-1 ring-stone-200 card-hover">';
                    html += '<div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-all z-10"></div>';
                    html += '<div class="absolute inset-0 flex items-center justify-center z-20"><div class="w-14 h-14 bg-white/95 rounded-full flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform"><i data-lucide="play" class="ml-1 text-teal-custom-900 fill-teal-custom-900 w-5 h-5"></i></div></div>';
                    html += '<img src="' + esc(thumb) + '" alt="" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">';
                    html += '</div><h3 class="font-serif text-xl font-bold mt-2 mb-1 line-clamp-2 text-stone-custom-900">' + title + '</h3>';
                    if (desc) html += '<p class="text-sm text-stone-600 line-clamp-2">' + desc + '</p>';
                    html += '</button></div>';
                }
                if (html) {
                    container.innerHTML = html;
                    if (typeof lucide !== 'undefined' && lucide.createIcons) lucide.createIcons();
                } else {
                    container.innerHTML = fallbackHtml;
                }
                if (loadingEl) loadingEl.remove();
            }
            if (!container) return;
            if (preloadedPlaylistItems && preloadedPlaylistItems.length > 0) {
                renderItems(preloadedPlaylistItems);
                return;
            }
            if (!publicYouTubeApiKey) {
                console.warn('Videos: PUBLIC_YOUTUBE_API_KEY is not set. Add it to .env and restart the dev server (or use the server that was started with .env).');
                container.innerHTML = fallbackHtml;
                if (loadingEl) loadingEl.remove();
                return;
            }
            var url = 'https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=' + playlistId + '&maxResults=8&key=' + publicYouTubeApiKey;
            fetch(url).then(function(r) {
                if (!r.ok) console.error('YouTube API HTTP', r.status, r.statusText);
                return r.json();
            }).then(function(data) {
                if (data.error) {
                    console.error('YouTube API error:', data.error.code, data.error.message);
                    container.innerHTML = fallbackHtml;
                    if (loadingEl) loadingEl.remove();
                    return;
                }
                if (!data.items || !data.items.length) {
                    container.innerHTML = fallbackHtml;
                    if (loadingEl) loadingEl.remove();
                    return;
                }
                renderItems(data.items);
            }).catch(function(err) {
                console.error('YouTube playlist fetch failed:', err);
                container.innerHTML = fallbackHtml;
                if (loadingEl) loadingEl.remove();
            });
        })();
    </script>
    <script is:inline>
        (function() {
            function moveModals() {
                var root = document.getElementById('modal-root');
                if (!root) return;
                var ids = ['memberVaultModalBackdrop', 'memberVaultModal', 'crochetPartnerModalBackdrop', 'crochetPartnerModal', 'videoModalBackdrop', 'videoModal'];
                for (var i = 0; i < ids.length; i++) {
                    var el = document.getElementById(ids[i]);
                    if (el && el.parentNode !== root) root.appendChild(el);
                }
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', moveModals);
            } else {
                moveModals();
            }
        })();
        lucide.createIcons();
        var carousel = document.getElementById('playlist-videos-container');
        var nextBtn = document.getElementById('nextBtn');
        var prevBtn = document.getElementById('prevBtn');
        if (carousel && nextBtn && prevBtn) {
            nextBtn.addEventListener('click', function () { carousel.scrollBy({ left: 320, behavior: 'smooth' }); });
            prevBtn.addEventListener('click', function () { carousel.scrollBy({ left: -320, behavior: 'smooth' }); });
        }
        (function() {
            var body = document.body;
            var ids = ['memberVaultModalBackdrop', 'memberVaultModal', 'crochetPartnerModalBackdrop', 'crochetPartnerModal', 'videoModalBackdrop', 'videoModal'];
            var videoIframe = document.getElementById('videoModalIframe');
            function closeAllModals() {
                body.classList.remove('member-vault-modal-open', 'crochet-partner-modal-open', 'video-modal-open');
                for (var i = 0; i < ids.length; i++) {
                    var el = document.getElementById(ids[i]);
                    if (el) el.setAttribute('aria-hidden', 'true');
                }
                if (videoIframe) videoIframe.src = '';
            }
            var backdrop = document.getElementById('memberVaultModalBackdrop');
            var modal = document.getElementById('memberVaultModal');
            var closeBtn = document.getElementById('memberVaultModalClose');
            var learnMoreBtns = document.querySelectorAll('.member-vault-learn-more');
            function openModal() {
                closeAllModals();
                body.classList.add('member-vault-modal-open');
                if (modal) modal.setAttribute('aria-hidden', 'false');
                if (backdrop) backdrop.setAttribute('aria-hidden', 'false');
            }
            if (closeBtn) closeBtn.addEventListener('click', closeAllModals);
            if (backdrop) backdrop.addEventListener('click', closeAllModals);
            if (learnMoreBtns && learnMoreBtns.length) {
                for (var i = 0; i < learnMoreBtns.length; i++) {
                    learnMoreBtns[i].addEventListener('click', openModal);
                }
            }
            backdrop = document.getElementById('crochetPartnerModalBackdrop');
            modal = document.getElementById('crochetPartnerModal');
            closeBtn = document.getElementById('crochetPartnerModalClose');
            learnMoreBtns = document.querySelectorAll('.crochet-partner-learn-more');
            function openCrochetModal() {
                closeAllModals();
                body.classList.add('crochet-partner-modal-open');
                if (modal) modal.setAttribute('aria-hidden', 'false');
                if (backdrop) backdrop.setAttribute('aria-hidden', 'false');
            }
            if (closeBtn) closeBtn.addEventListener('click', closeAllModals);
            if (backdrop) backdrop.addEventListener('click', closeAllModals);
            if (learnMoreBtns && learnMoreBtns.length) {
                for (var i = 0; i < learnMoreBtns.length; i++) {
                    learnMoreBtns[i].addEventListener('click', openCrochetModal);
                }
            }
            backdrop = document.getElementById('videoModalBackdrop');
            modal = document.getElementById('videoModal');
            closeBtn = document.getElementById('videoModalClose');
            var container = document.getElementById('playlist-videos-container');
            function openVideoModal(videoId, title, description) {
                closeAllModals();
                var titleEl = document.getElementById('videoModalTitle');
                var descEl = document.getElementById('videoModalDescription');
                if (titleEl) titleEl.textContent = title || 'Watch video';
                if (descEl) {
                    var text = (description || '').trim();
                    if (text.length > 300) text = text.slice(0, 300) + '…';
                    descEl.textContent = text;
                    descEl.setAttribute('aria-hidden', text ? 'false' : 'true');
                    descEl.style.display = text ? 'block' : 'none';
                }
                if (videoIframe && videoId) {
                    videoIframe.src = 'https://www.youtube.com/embed/' + videoId;
                }
                body.classList.add('video-modal-open');
                if (modal) modal.setAttribute('aria-hidden', 'false');
                if (backdrop) backdrop.setAttribute('aria-hidden', 'false');
            }
            if (closeBtn) closeBtn.addEventListener('click', closeAllModals);
            if (backdrop) backdrop.addEventListener('click', closeAllModals);
            if (container) container.addEventListener('click', function(e) {
                var btn = e.target.closest('.video-card-trigger');
                if (!btn) return;
                var id = btn.getAttribute('data-video-id');
                var title = btn.getAttribute('data-video-title') || 'Watch video';
                var description = btn.getAttribute('data-video-description') || '';
                if (id) openVideoModal(id, title, description);
            });
        })();
    </script>
</Layout>
